<!DOCTYPE html>
<html lang="pr-br"> <!-- Define o idioma como português do Brasil (obs: corrigir 'pr-br' para 'pt-br') -->
<head>
    <!-- Configuração de caracteres -->
    <meta charset="UTF-8">

    <!-- Responsividade para dispositivos móveis -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Portfólio | Mapa</title> <!-- Título da aba do navegador -->

    <!-- CSS principal -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Ícones do Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <!-- CSS do Leaflet (mapa) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" crossorigin=""/>

    <!-- CSS do controle de rotas do Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css">

    <!-- Biblioteca principal do Leaflet (mapa) -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" crossorigin=""></script>
</head>

<body>

<!-- Seção de contato que aqui está sendo usada para exibir o mapa -->
<section class="contato" id="contato">

    <!-- Botão para voltar para o portfólio -->
    <div class="bataoVolt">
        <a href="https://leonardodlima.github.io/Portfolio/#portfolio" class="btnVolt" id="voltar">
            <i class="bi bi-arrow-left-circle-fill"></i>  Voltar
        </a>
    </div>

    <!-- Título da página -->
    <h2 class="cabecario">Sua <span>Distancia!</span></h2>

    <!-- Área onde será exibida a distância calculada -->
    <div>
        <h1 id="txtDistancia">Sua distancia até mim é:
            <h1 id="km"></h1> <!-- Distância será preenchida via JS -->
        </h1>
    </div>

    <!-- Título que será substituído pelo mapa -->
    <h2 id="mapa"></h2>

    <!-- Container onde o mapa será renderizado -->
    <div id="mapid"></div>

    <!-- Elemento onde as coordenadas serão exibidas -->
    <div id="distancia"></div>

</section>

</body>
</html>

<script>
    // Seleciona o título que será usado para o mapa
let mapa = document.querySelector('#mapa');

// Declara as variáveis do mapa e dos elementos HTML que vão exibir informações
var map;
var h2 = document.querySelector('#distancia'); // Exibe coordenadas
var h3 = document.querySelector('#km'); // Exibe a distância em km

// Ícone personalizado para marcar "Minha casa" no mapa
var iconHouse = L.icon({
    iconUrl: 'imagens/pngwing.com.png',
    iconSize: [40,40] // Tamanho do ícone
});

// Função executada quando a geolocalização é obtida com sucesso
function success(pos){
    console.log(pos.coords.latitude, pos.coords.longitude); // Mostra as coordenadas no console

    // Exibe as coordenadas no elemento <div id="distancia">
    h2.textContent = `Sua coordenada é: Latitude:${pos.coords.latitude}, Longitude:${pos.coords.longitude}`;

    // Define os pontos fixos: casa (fixa) e posição do usuário (dinâmica)
    var casa = L.latLng(-25.467892800886762, -49.1306297830648);
    var posi = L.latLng(pos.coords.latitude, pos.coords.longitude);

    mapa.textContent = ''; // Limpa o título (está vazio)

    // Cria o mapa se ainda não existir
    if (map === undefined) {
        map = L.map('mapid').setView([pos.coords.latitude, pos.coords.longitude], 0);
    }

    // Adiciona o tile padrão do OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    }).addTo(map);

    // Adiciona marcador da casa no mapa
    L.marker(casa, {icon: iconHouse}).addTo(map).bindPopup('Minha casa!').openPopup();

    // Adiciona marcador da posição do usuário no mapa
    L.marker(posi).addTo(map).bindPopup('Sua posição!').openPopup();

    // Controla a rota traçada entre os dois pontos
    L.Routing.control({
        waypoints: [casa, posi], // Pontos de origem e destino
        routeWhileDragging: false // Não atualiza a rota ao arrastar
    })
    .on('routesfound', function (e) { // Quando a rota é encontrada
        var route = e.routes[0]; // Pega a primeira rota encontrada
        var distanciaKm = (route.summary.totalDistance / 1000).toFixed(2); // Converte para km e formata com 2 casas decimais
        console.log('Distância total da rota: ' + distanciaKm + ' km');

        // Exibe a distância calculada
        h3.textContent = `${distanciaKm} km`;
    })
    .on('routesfound', function (e) { // Segunda escuta (não necessária, está repetida)
        console.log(e);
    })
    .addTo(map);
}

// Função executada se der erro ao obter a localização
function error(err){
    console.log(err);
}

// Solicita a localização do usuário
navigator.geolocation.getCurrentPosition(success, error, {
    enableHighAccuracy: true // Pede alta precisão
});

</script>

<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script> 
<!-- Controla rotas no mapa -->

<script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
<!-- Biblioteca Turf.js para cálculos geográficos -->

<script src="typed.js@2.0.12.js"></script>
<!-- Biblioteca para criar texto digitado automaticamente (não está sendo usada aqui) -->

<script src="scrollreveal.js"></script>
<!-- Biblioteca para animações ao rolar a página (não está sendo usada aqui) -->

<script src="script.js"> </script>
<!-- Script principal do seu projeto (provavelmente contém animações e interações) -->
